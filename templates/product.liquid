{% comment %}
  Product page template
{% endcomment %}

<div class="product-page">
  <div class="container">
    <div class="product-wrapper">
      <div class="product-images">
        <div class="product-gallery">
          {% for media in product.media %}
            {% case media.media_type %}
              {% when 'image' %}
                <div class="product-image">
                  <img src="{{ media | image_url: width: 800 }}" 
                       alt="{{ media.alt | escape }}"
                       loading="lazy">
                </div>
              {% when 'video' %}
                <div class="product-video">
                  {{ media | video_tag: controls: true }}
                </div>
              {% when 'model' %}
                <div class="product-model">
                  {{ media | model_viewer_tag }}
                </div>
            {% endcase %}
          {% endfor %}
        </div>
      </div>

      <div class="product-details">
        <h1 class="product-title">{{ product.title }}</h1>
        <div class="product-price">
          {% if product.compare_at_price > product.price %}
            <span class="price-sale">{{ product.price | money }}</span>
            <span class="price-compare">{{ product.compare_at_price | money }}</span>
          {% else %}
            <span class="price">{{ product.price | money }}</span>
          {% endif %}
        </div>

        {% if product.description != blank %}
          <div class="product-description">
            {{ product.description }}
          </div>
        {% endif %}

        <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="product-form">
          {% unless product.has_only_default_variant %}
            <div class="product-variants">
              {% for option in product.options_with_values %}
                <div class="variant-option">
                  <label for="Option-{{ forloop.index0 }}">{{ option.name }}</label>
                  <select name="id" id="Option-{{ forloop.index0 }}">
                    {% for value in option.values %}
                      <option value="{{ value | escape }}"
                              {% if option.selected_value == value %}selected="selected"{% endif %}>
                        {{ value }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          {% endunless %}

          <div class="product-actions">
            <div class="quantity-selector">
              <button type="button" class="quantity-btn minus">-</button>
              <input type="number" name="quantity" value="1" min="1" class="quantity-input">
              <button type="button" class="quantity-btn plus">+</button>
            </div>
            <button type="submit" class="btn btn-primary add-to-cart-btn">
              Add to Cart
            </button>
          </div>
        </form>

        {% if product.tags contains 'featured' %}
          <div class="product-badges">
            <span class="badge featured">Featured</span>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  // Quantity selector functionality
  document.querySelectorAll('.quantity-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const input = this.parentNode.querySelector('.quantity-input');
      const currentValue = parseInt(input.value);
      
      if (this.classList.contains('plus')) {
        input.value = currentValue + 1;
      } else if (this.classList.contains('minus') && currentValue > 1) {
        input.value = currentValue - 1;
      }
    });
  });

  // Variant selection
  document.querySelectorAll('[name="id"]').forEach(select => {
    select.addEventListener('change', function() {
      // Update variant-specific content
      console.log('Variant changed:', this.value);
    });
  });
</script>
